<!-- Tree section -->
<mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="navigation-tree">
    <!-- This ist the tree node for leafs -->
    <mat-tree-node *matTreeNodeDef="let node">
        <div class="w-100">
            <div class="fs-6">
                <div id="{{node.mgId}}-node" class="tree-node" [class.ms-4]="!node.parent"
                    (click)="selectFilter($event, node)">{{
                    node.fullName.endsWith('(Modulgruppe)') || node.fullName.endsWith('(Fach)') ? node.name :
                    node.fullName}}</div>
                <ng-container *ngTemplateOutlet="groupMetaInformation; context: { group: node }"></ng-container>
                <ng-container *ngIf="selectedGroupFilter && selectedGroupFilter.value === node.mgId">
                    <ng-container *ngTemplateOutlet="groupDescription; context: { group: node }"></ng-container>
                </ng-container>
            </div>
            <hr *ngIf="!node.parent" class="mt-1 mb-2" />
        </div>
    </mat-tree-node>
    <!-- This is the tree node template for expandable nodes -->
    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <div class="mat-tree-node">
            <div class="fs-6">
                <div id="{{node.mgId}}-node" class="tree-node">
                    <i matTreeNodeToggle (click)="toggleNode(node)" class="bi bi-chevron-right me-2" *ngIf="!treeControl.isExpanded(node)"></i>
                    <i matTreeNodeToggle (click)="toggleNode(node)" class="bi bi-chevron-down me-2" *ngIf="treeControl.isExpanded(node)"></i>
                    <span (click)="selectFilter($event, node)">{{ node.fullName.endsWith('(Modulgruppe)') ||
                        node.fullName.endsWith('(Fach)') ?
                        node.name : node.fullName}}</span>
                </div>
                <ng-container *ngTemplateOutlet="groupMetaInformation; context: { group: node }"></ng-container>
            </div>
        </div>
        <!-- There is inline padding applied to this div using styles.
            This padding value depends on the mat-icon-button width.  -->
        <div [class.navigation-tree-invisible]="!treeControl.isExpanded(node)" role="group">
            <ng-container *ngTemplateOutlet="groupDescription; context: { group: node }"></ng-container>
            <ng-container matTreeNodeOutlet></ng-container>
        </div>
        <hr *ngIf="!node.parent" class="mt-1 mb-2" />
    </mat-nested-tree-node>
</mat-tree>

<!--------------------------------------------
  -------- Template Section ------------------
  -------------------------------------------->
<!-- Template for description of moduleGroup -->
<ng-template #groupDescription let-group="group">
    <div *ngIf="group.desc != ''" class="d-flex flex-row align-items-start my-1 s-text"
        [ngClass]="group.desc.length > 200 ? 'truncate' : ''">
        <div role="button" class="px-2" *ngIf="group.desc.length > 200">
            <i id="{{ group.mgId }}-icon" class="bi bi-chevron-down" (click)="toggleModuleDescription($event, group)"
                (keyup.enter)="toggleModuleDescription($event, group)">
            </i>
        </div>
        <div id="{{ group.mgId }}-description" [ngClass]="group.desc.length > 200 ? 'truncate-text' : ''"
            [innerHtml]="group.desc"></div>
    </div>
</ng-template>

<ng-template #groupMetaInformation let-group="group">
    <div class="d-flex flex-row ms-4">
        <div *ngIf="group.ectsMin !== undefined && group.ectsMax" class="me-2">
            <div class="chip xs-chip ects-chip" *ngIf="group.ectsMin == group.ectsMax">
                {{ group.ectsMin }} ECTS
            </div>
            <div class="chip xs-chip ects-chip" *ngIf="group.ectsMin != group.ectsMax">
                {{ group.ectsMin }} - {{ group.ectsMax }} ECTS
            </div>
        </div>
        <div *ngIf="group.achievedEcts" class="chip xs-chip success-chip">
            Erreicht: {{ group.achievedEcts }} ECTS
        </div>
    </div>
</ng-template>